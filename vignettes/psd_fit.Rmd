---
title: "Fit PSD model"
author: Jonathon Chow
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    toc_float: no
    highlight: textmate
    theme: readable
vignette: >
  %\VignetteIndexEntry{Fit PSD model}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# PSD model and data

We consider the first chromosome data from the 1000 Genomes Project and use a PSD model to fit these data.

```{r}
library(AwesomePackage)
data(genome_chr1)
```

# Fit PSD model by EM algorithm

We fit the PSD model with EM algorithm, and use the loss function as a stopping criterion.

```{r eval=FALSE}
result_em <- psd_fit_em(genome_chr1, 3, 1e-3, 500)
```

We import the pre-trained results.

```{r}
data(result_em)
```

We plot the loss function against the number of iterations.

```{r}
L_em <- result_em$"Loss"
plot(L_em)
```

We plot the ancestral proportions of individuals using package ggplot2.

```{r}
P_em <- result_em$"P"
topics <- order(colMeans(P_em))
colors <- c("red", "yellow", "blue")
structure_plot(P_em, topics, colors)
```

# Fit PSD model by SQP algorithm

We fit the PSD model with SQP algorithm, and use the loss function as a stopping criterion.

```{r eval=FALSE}
result_sqp <- psd_fit_sqp(genome_chr1, 3, 1e-3, 500, 100)
```

We import the pre-trained results.

```{r}
data(result_sqp)
```

We plot the loss function against the number of iterations.

```{r}
L_sqp <- result_sqp$"Loss"
plot(L_sqp)
```

We plot the ancestral proportions of individuals using package ggplot2.

```{r}
P_sqp <- result_sqp$"P"
topics <- order(colMeans(P_sqp))
colors <- c("red", "yellow", "blue")
structure_plot(P_sqp, topics, colors)
```

# Fit PSD model by VI algorithm

We fit the PSD model with VI algorithm, and use the loss function as a stopping criterion. Due to the different calculation methods of the loss function, the value of `epsilon` needs to be smaller than the previous two algorithms.

```{r eval=FALSE}
result_vi <- psd_fit_vi(genome_chr1, 3, 1e-9, 500)
```

We import the pre-trained results.

```{r}
data(result_vi)
```

We plot the loss function against the number of iterations. Different from the previous two algorithms, the loss function records once for ten iterations.

```{r}
L_vi <- result_vi$Loss
plot(L_vi)
```

We plot the ancestral proportions of individuals using package ggplot2.

```{r}
P_vi <- result_vi$P
topics <- order(colMeans(P_vi))
colors <- c("red", "yellow", "blue")
structure_plot(P_vi, topics, colors)
```
